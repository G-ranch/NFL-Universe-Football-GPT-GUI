-- ⚡ G-Admin Panel v5 (Pro GUI) - client-only, safe
-- Squircle icon, minimize/restore, position memory, smart Steal & Tackle, mobile/iPad draggable

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer

-- ---------- Helpers ----------
local function getChar()
	local c = player.Character or player.CharacterAdded:Wait()
	return c, c:FindFirstChild("HumanoidRootPart"), c:FindFirstChildOfClass("Humanoid")
end

local function savePosition(key, ud2)
	local gui = player:FindFirstChild("PlayerGui")
	if not gui then return end
	local s = string.format("%f,%d,%f,%d", ud2.X.Scale, ud2.X.Offset, ud2.Y.Scale, ud2.Y.Offset)
	local v = gui:FindFirstChild(key) or Instance.new("StringValue")
	v.Name = key
	v.Value = s
	v.Parent = gui
end

local function loadPosition(key, default)
	local gui = player:FindFirstChild("PlayerGui")
	if not gui then return default end
	local v = gui:FindFirstChild(key)
	if not v or v.Value == "" then return default end
	local a,b,c,d = v.Value:match("([^,]+),([^,]+),([^,]+),([^,]+)")
	if not a then return default end
	return UDim2.new(tonumber(a) or default.X.Scale, tonumber(b) or default.X.Offset,
		             tonumber(c) or default.Y.Scale, tonumber(d) or default.Y.Offset)
end

-- ---------- Smart football finder ----------
local function findFootball()
	local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
	local origin = hrp and hrp.Position or Vector3.new(0,0,0)
	local nearest, nd = nil, math.huge
	local holderName, held = "None", false
	for _, obj in ipairs(Workspace:GetDescendants()) do
		if obj:IsA("BasePart") and obj.Name:lower():find("football") and not obj.Anchored then
			local dist = (obj.Position - origin).Magnitude
			if dist < nd and dist < 500 then
				nearest, nd = obj, dist
				local p = obj.Parent
				if p and Players:FindFirstChild(p.Name) then
					holderName = p.Name
					held = true
				else
					holderName = "None"
					held = false
				end
			end
		end
	end
	return nearest, holderName, held
end

-- ---------- Build GUI ----------
local gui = Instance.new("ScreenGui")
gui.Name = "GAdmin_v5"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

local PANEL_KEY = "GAdmin_v5_Panel"
local ICON_KEY  = "GAdmin_v5_Icon"

-- Panel
local panel = Instance.new("Frame", gui)
panel.Size = UDim2.new(0, 260, 0, 340)
panel.Position = loadPosition(PANEL_KEY, UDim2.new(0, 48, 0.5, -170))
panel.AnchorPoint = Vector2.new(0,0)
panel.BackgroundColor3 = Color3.fromRGB(20,22,30)
panel.BorderSizePixel = 0
panel.Active = true
panel.Visible = true

local pCorner = Instance.new("UICorner", panel); pCorner.CornerRadius = UDim.new(0,12)
local pStroke = Instance.new("UIStroke", panel); pStroke.Thickness = 1; pStroke.Transparency = 0.7; pStroke.Color = Color3.fromRGB(70,100,255)

local grad = Instance.new("UIGradient", panel)
grad.Color = ColorSequence.new{
	ColorSequenceKeypoint.new(0, Color3.fromRGB(26,28,38)),
	ColorSequenceKeypoint.new(1, Color3.fromRGB(18,20,28))
}
grad.Rotation = 90

-- Title bar
local title = Instance.new("Frame", panel)
title.Size = UDim2.new(1, 0, 0, 36)
title.BackgroundTransparency = 1
local titleLabel = Instance.new("TextLabel", title)
titleLabel.Size = UDim2.new(1, -12, 1, 0)
titleLabel.Position = UDim2.new(0, 8, 0, 0)
titleLabel.BackgroundTransparency = 1
titleLabel.Text = "⚡ G-Admin Panel v5"
titleLabel.Font = Enum.Font.GothamBold
titleLabel.TextSize = 15
titleLabel.TextColor3 = Color3.fromRGB(235,235,245)
titleLabel.TextXAlignment = Enum.TextXAlignment.Left

-- Buttons layout
local layout = Instance.new("UIListLayout", panel)
layout.Padding = UDim.new(0,8)
layout.SortOrder = Enum.SortOrder.LayoutOrder
layout.FillDirection = Enum.FillDirection.Vertical
layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
layout.VerticalAlignment = Enum.VerticalAlignment.Top

local function makeButton(text)
	local b = Instance.new("TextButton")
	b.Size = UDim2.new(1, -20, 0, 36)
	b.BackgroundColor3 = Color3.fromRGB(36,42,70)
	b.AutoButtonColor = true
	b.Font = Enum.Font.Gotham
	b.TextSize = 13
	b.TextColor3 = Color3.fromRGB(245,245,255)
	b.Text = text
	local c = Instance.new("UICorner", b); c.CornerRadius = UDim.new(0,8)
	local s = Instance.new("UIStroke", b); s.Thickness = 1; s.Transparency = 0.75; s.Color = Color3.fromRGB(85,110,255)
	return b
end

local status = Instance.new("TextLabel", panel)
status.Size = UDim2.new(1, -20, 0, 22)
status.BackgroundTransparency = 1
status.Font = Enum.Font.Gotham
status.TextSize = 13
status.TextColor3 = Color3.fromRGB(140,255,170)
status.Text = "Ready"
status.LayoutOrder = 99

local function setStatus(txt, color)
	status.Text = txt
	if color then status.TextColor3 = color end
	task.delay(2.5, function()
		if status and status.Parent then
			status.Text = "Ready"
			status.TextColor3 = Color3.fromRGB(140,255,170)
		end
	end)
end

-- Buttons
local stealBtn  = makeButton("🏈 STEAL BALL")
local tackleBtn = makeButton("💥 AUTO TACKLE")
local speedBtn  = makeButton("⚡ SUPER SPEED (128)")
local noclipBtn = makeButton("🧱 NOCLIP")
stealBtn.LayoutOrder, tackleBtn.LayoutOrder, speedBtn.LayoutOrder, noclipBtn.LayoutOrder = 1,2,3,4

stealBtn.Parent = panel
tackleBtn.Parent = panel
speedBtn.Parent = panel
noclipBtn.Parent = panel
status.Parent = panel

-- Squircle Icon (30% smaller)
local icon = Instance.new("TextButton", gui)
icon.Name = "GAdminIcon"
icon.Size = UDim2.new(0, 96, 0, 96)
icon.Position = loadPosition(ICON_KEY, UDim2.new(0, 12, 0.5, -48))
icon.BackgroundColor3 = Color3.fromRGB(50,95,255)
icon.AutoButtonColor = true
icon.Text = ""
icon.Active = true

local iCorner = Instance.new("UICorner", icon); iCorner.CornerRadius = UDim.new(0, 26)
local iStroke = Instance.new("UIStroke", icon); iStroke.Thickness = 2; iStroke.Color = Color3.fromRGB(140,180,255); iStroke.Transparency = 0.2
local iGradient = Instance.new("UIGradient", icon); iGradient.Rotation = 45
iGradient.Color = ColorSequence.new{
	ColorSequenceKeypoint.new(0, Color3.fromRGB(58,110,255)),
	ColorSequenceKeypoint.new(1, Color3.fromRGB(30,80,220))
}
local icoLabel = Instance.new("TextLabel", icon)
icoLabel.Size = UDim2.new(1,0,1,0)
icoLabel.BackgroundTransparency = 1
icoLabel.Text = "🏈"
icoLabel.Font = Enum.Font.GothamBold
icoLabel.TextSize = 32
icoLabel.TextColor3 = Color3.fromRGB(255,255,255)

-- Auto-open panel
panel.Visible = true
icon.Visible = false

-- ---------- Draggables (mobile/iPad + PC) ----------
local function makeDraggable(frame, key)
	local dragging, startPos, startInput

	local function update(input)
		if dragging and input then
			local delta = input.Position - startInput.Position
			frame.Position = UDim2.new(
				startPos.X.Scale, startPos.X.Offset + delta.X,
				startPos.Y.Scale, startPos.Y.Offset + delta.Y
			)
		end
	end

	frame.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			startInput = input
			startPos = frame.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
					pcall(function() savePosition(key, frame.Position) end)
				end
			end)
		end
	end)

	frame.InputChanged:Connect(update)
	UserInputService.InputChanged:Connect(update)
end

makeDraggable(panel, PANEL_KEY)
makeDraggable(icon, ICON_KEY)

-- ---------- Minimize / Restore ----------
local function minimizeToIcon()
	TweenService:Create(panel, TweenInfo.new(0.18, Enum.EasingStyle.Quad), {Size = UDim2.new(0,0,0,0), BackgroundTransparency = 1}):Play()
	task.wait(0.18)
	panel.Visible = false
	icon.Position = panel.Position
	icon.Visible = true
	savePosition(PANEL_KEY, panel.Position)
	savePosition(ICON_KEY, icon.Position)
end

local function restoreFromIcon()
	panel.Position = icon.Position
	panel.Visible = true
	TweenService:Create(panel, TweenInfo.new(0.18, Enum.EasingStyle.Quad), {Size = UDim2.new(0,260,0,340), BackgroundTransparency = 0}):Play()
	icon.Visible = false
	savePosition(PANEL_KEY, panel.Position)
end

-- Double-click title to minimize
do
	local last = 0
	title.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			local t = tick()
			if last ~= 0 and (t - last) < 0.35 then
				minimizeToIcon()
			end
			last = t
		end
	end)
end

icon.MouseButton1Click:Connect(function()
	if panel.Visible then minimizeToIcon() else restoreFromIcon() end
end)
panel.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton2 then minimizeToIcon() end
end)

-- ---------- Feature loops & toggles ----------
local magnetLoop, tackleLoop, speedLoop, noclipLoop

-- Steal Ball
stealBtn.MouseButton1Click:Connect(function()
	local active = stealBtn:GetAttribute("Active")
	active = not active
	stealBtn:SetAttribute("Active", active)
	if active then
		stealBtn.Text = "🏈 STEALING..."
		stealBtn.BackgroundColor3 = Color3.fromRGB(45,220,130)
		setStatus("Moving to ball...", Color3.fromRGB(255,220,80))
		if magnetLoop then magnetLoop:Disconnect() end
		magnetLoop = RunService.Heartbeat:Connect(function()
			local _, hrp = getChar()
			local ball, _, held = findFootball()
			if not hrp then return end
			if not ball or held then
				if magnetLoop then magnetLoop:Disconnect() end
				stealBtn:SetAttribute("Active", false)
				stealBtn.Text = "🏈 STEAL BALL"
				stealBtn.BackgroundColor3 = Color3.fromRGB(36,42,70)
				setStatus("No ball / grabbed", Color3.fromRGB(255,110,110))
				return
			end
			local dist = (ball.Position - hrp.Position).Magnitude
			if dist < 6 then
				if magnetLoop then magnetLoop:Disconnect() end
				stealBtn:SetAttribute("Active", false)
				stealBtn.Text = "🏈 STEAL BALL"
				stealBtn.BackgroundColor3 = Color3.fromRGB(36,42,70)
				setStatus("✅ Ball reached!", Color3.fromRGB(100,255,160))
				return
			end
			local dir = (ball.Position - hrp.Position).Unit
			local target = ball.Position + dir * 3 + Vector3.new(0,3,0)
			pcall(function() hrp.CFrame = CFrame.new(target, ball.Position) end)
		end)
	else
		if magnetLoop then magnetLoop:Disconnect() end
		stealBtn.Text = "🏈 STEAL BALL"
		stealBtn.BackgroundColor3 = Color3.fromRGB(36,42,70)
		setStatus("Steal off", Color3.fromRGB(160,160,160))
	end
end)

-- Auto Tackle
tackleBtn.MouseButton1Click:Connect(function()
	local active = tackleBtn:GetAttribute("Active")
	active = not active
	tackleBtn:SetAttribute("Active", active)
	if active then
		tackleBtn.Text = "💥 AUTO: ON"
		tackleBtn.BackgroundColor3 = Color3.fromRGB(255,120,90)
		setStatus("Chasing carrier", Color3.fromRGB(255,220,80))
		if tackleLoop then tackleLoop:Disconnect() end
		tackleLoop = RunService.Heartbeat:Connect(function()
			local _, hrp = getChar()
			local ball, owner, held = findFootball()
			if not hrp or not ball then return end
			if held and owner and owner ~= player.Name then
				local target = Players:FindFirstChild(owner)
				if target and target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
					local tHRP = target.Character.HumanoidRootPart
					local dist = (tHRP.Position - hrp.Position).Magnitude
					if dist > 7 then
						local dir = (tHRP.Position - hrp.Position).Unit
						local pos = tHRP.Position - dir * 5 + Vector3.new(0,3,0)
						pcall(function() hrp.CFrame = CFrame.new(pos, tHRP.Position) end)
					end
				end
			end
		end)
	else
		if tackleLoop then tackleLoop:Disconnect() end
		tackleBtn.Text = "💥 AUTO TACKLE"
		tackleBtn.BackgroundColor3 = Color3.fromRGB(36,42,70)
		setStatus("Tackle off", Color3.fromRGB(160,160,160))
	end
end)

-- SuperSpeed 128
speedBtn.MouseButton1Click:Connect(function()
	local active = speedBtn:GetAttribute("Active")
	active = not active
	speedBtn:SetAttribute("Active", active)
	local _,_,hum = getChar()
	if active then
		speedBtn.Text = "⚡ SPEED: ON (128)"
		speedBtn.BackgroundColor3 = Color3.fromRGB(255,200,0)
		setStatus("SuperSpeed on", Color3.fromRGB(255,240,140))
		if speedLoop then speedLoop:Disconnect() end
		speedLoop = RunService.Heartbeat:Connect(function() if hum and hum.Parent then hum.WalkSpeed = 128 end end)
	else
		if speedLoop then speedLoop:Disconnect() end
		if hum and hum.Parent then hum.WalkSpeed = 16 end
		speedBtn.Text = "⚡ SUPER SPEED (128)"
		speedBtn.BackgroundColor3 = Color3.fromRGB(36,42,70)
		setStatus("Speed off", Color3.fromRGB(160,160,160))
	end
end)

-- NoClip
noclipBtn.MouseButton1Click:Connect(function()
	local active = noclipBtn:GetAttribute("Active")
	active = not active
	noclipBtn:SetAttribute("Active", active)
	if active then
		noclipBtn.Text = "🧱 NOCLIP: ON"
		noclipBtn.BackgroundColor3 = Color3.fromRGB(0,170,230)
		setStatus("NoClip active", Color3.fromRGB(120,220,255))
		if noclipLoop then noclipLoop:Disconnect() end
		noclipLoop = RunService.Stepped:Connect(function()
			local char = player.Character
			if char then
				for _, p in ipairs(char:GetDescendants()) do
					if p:IsA("BasePart") then p.CanCollide = false end
				end
			end
		end)
	else
		if noclipLoop then noclipLoop:Disconnect() end
		noclipBtn.Text = "🧱 NOCLIP"
		noclipBtn.BackgroundColor3 = Color3.fromRGB(36,42,70)
		setStatus("NoClip off", Color3.fromRGB(160,160,160))
	end
end)

-- ---------- Autosave & respawn ----------
task.spawn(function()
	while true do
		task.wait(6)
		if panel and panel.Parent then pcall(function() savePosition(PANEL_KEY, panel.Position) end) end
		if icon and icon.Parent then pcall(function() savePosition(ICON_KEY, icon.Position) end) end
	end
end)

player.CharacterAdded:Connect(function()
	task.wait(0.6)
	if speedBtn:GetAttribute("Active") then
		local _,_,hum = getChar()
		if hum then hum.WalkSpeed = 128 end
	end
end)

savePosition(PANEL_KEY, panel.Position)
savePosition(ICON_KEY, icon.Position)
setStatus("G-Admin v5 ready ✅", Color3.fromRGB(120,255,180))
